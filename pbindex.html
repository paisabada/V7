<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PB (PaisaBada) | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
:root{
  --teal:#00b4b0;
  --teal2:#0077ff;
  --navy:#002b5b;
  --gold:#f4c430;
  --bg1:#2c1b66;
  --bg2:#a0208c;
}

/* PAGE BG */
body{
  margin:0;
  font-family:Poppins,Arial,sans-serif;
  background:linear-gradient(90deg,var(--teal),var(--teal2));
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:32px 16px;
  box-sizing:border-box;
}

/* MAIN SHELL */
.shell{
  width:100%;
  max-width:1040px;
  background:#f7f9ff;
  border-radius:24px;
  box-shadow:0 22px 48px rgba(0,0,0,.35);
  overflow:hidden;
  animation:fadeUp .45s ease-out;
}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(40px)}
  to{opacity:1;transform:translateY(0)}
}

/* HEADER */
.header{
  background:radial-gradient(circle at top,var(--bg2),var(--bg1));
  padding:18px 26px 20px;
  color:#fff;
}
.header-row{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:16px;
}
.header-left{
  display:flex;
  gap:12px;
  align-items:center;
}
#avatar{
  width:52px;
  height:52px;
  border-radius:50%;
  background:conic-gradient(from 180deg,var(--teal),#9af7ec,var(--navy));
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:22px;
  box-shadow:0 0 0 3px rgba(255,255,255,.25);
  animation:avatarPulse 2.2s infinite ease-in-out;
}
@keyframes avatarPulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.03);}
}
.hl-title{
  font-size:18px;
  font-weight:600;
}
.hl-sub{
  font-size:12px;
  opacity:.9;
  margin-top:2px;
}
.header-right{
  text-align:right;
}
.pb-tag{
  display:inline-block;
  font-size:11px;
  padding:6px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.18);
  border:1px solid rgba(255,255,255,.35);
}
.pb-tag span{
  font-weight:600;
}
.last-login{
  font-size:11px;
  opacity:.85;
  margin-top:6px;
}

/* HEADER â€“ STAT CARDS ROW */
.stats-row{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:10px;
  margin-top:16px;
}
.stat-card{
  background:rgba(255,255,255,.14);
  border-radius:14px;
  padding:9px 11px;
  border:1px solid rgba(255,255,255,.25);
  backdrop-filter:blur(6px);
}
.stat-label{
  font-size:11px;
  opacity:.9;
}
.stat-value{
  margin-top:4px;
  font-size:18px;
  font-weight:700;
}
.stat-foot{
  margin-top:2px;
  font-size:11px;
  opacity:.9;
}

/* MAIN CONTENT */
.content{
  padding:18px 22px 22px;
}

/* SECTION TITLES */
.section-title{
  font-size:15px;
  font-weight:600;
  color:#253257;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.section-title small{
  font-size:11px;
  font-weight:400;
  color:#6b7280;
}

/* WHAT YOU CAN DO HERE CARD */
.do-card{
  margin-top:10px;
  background:#ffffff;
  border-radius:16px;
  padding:10px 12px;
  box-shadow:0 6px 18px rgba(15,23,42,.12);
  border:1px solid #e5e7eb;
  font-size:11px;
  color:#374151;
}
.do-title{
  font-size:13px;
  font-weight:600;
  color:#111827;
  margin-bottom:4px;
}
.do-list{
  margin:0;
  padding-left:16px;
}
.do-list li{
  margin-bottom:2px;
}

/* SNAPSHOT + NEXT ACTION */
.snapshot-wrap{
  margin-top:14px;
  display:grid;
  grid-template-columns: minmax(0,2fr) minmax(0,1.6fr);
  gap:14px;
}
.snapshot-card{
  background:#ffffff;
  border-radius:16px;
  padding:12px 14px;
  box-shadow:0 8px 20px rgba(15,23,42,.12);
  border:1px solid #e5e7eb;
}
.snap-title{
  font-size:13px;
  font-weight:600;
  color:#111827;
}
.snap-sub{
  font-size:11px;
  color:#6b7280;
  margin-top:2px;
}
.snap-grid{
  margin-top:8px;
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:6px;
}
.snap-item{
  background:#f9fafb;
  border-radius:10px;
  padding:6px 7px;
  font-size:11px;
}
.snap-item-label{
  color:#6b7280;
}
.snap-item-value{
  font-weight:600;
  color:#111827;
}
.snap-highlight{
  margin-top:8px;
  padding:7px 9px;
  border-radius:12px;
  background:#ecfdf5;
  font-size:11px;
  color:#166534;
}

/* NEXT ACTION PANEL */
.next-action{
  background:linear-gradient(135deg,#eef2ff,#ecfeff);
  border-radius:16px;
  padding:12px 14px;
  box-shadow:0 8px 20px rgba(15,23,42,.12);
  border:1px solid #e5e7eb;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.na-label{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.04em;
  color:#4b5563;
}
#nextActionText{
  font-size:13px;
  font-weight:600;
  color:#111827;
}
.na-foot{
  font-size:11px;
  color:#6b7280;
}
.na-buttons{
  margin-top:6px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.btn-chip{
  border-radius:999px;
  border:none;
  padding:6px 12px;
  font-size:11px;
  cursor:pointer;
  background:var(--teal);
  color:#fff;
  font-weight:500;
}
.btn-chip.secondary{
  background:#e5f2ff;
  color:#1d4ed8;
}

/* TOOLS / OFFERS / VAULT GRID */
.tools-section{
  margin-top:20px;
}
.tools-grid{
  margin-top:10px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}
.tool-card{
  background:#ffffff;
  border-radius:16px;
  padding:10px 11px;
  box-shadow:0 6px 16px rgba(15,23,42,.12);
  border:1px solid #e5e7eb;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  gap:4px;
  transition:transform .18s, box-shadow .18s, border-color .18s;
}
.tool-card:hover{
  transform:translateY(-3px);
  box-shadow:0 10px 22px rgba(15,23,42,.2);
  border-color:var(--teal);
}
.tool-card:active{
  transform:translateY(-1px);
  box-shadow:0 6px 16px rgba(15,23,42,.16);
}
.tool-icon{
  font-size:20px;
}
.tool-title{
  font-size:13px;
  font-weight:600;
  color:#111827;
}
.tool-sub{
  font-size:11px;
  color:#6b7280;
}
.tool-tag{
  font-size:10px;
  margin-top:2px;
  color:#0f766e;
}

/* CAMPAIGNS / REWARDS */
.campaigns{
  margin-top:20px;
}
.campaign-list{
  margin-top:10px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:12px;
}
.camp-card{
  background:#ffffff;
  border-radius:16px;
  padding:10px 12px;
  box-shadow:0 6px 16px rgba(15,23,42,.12);
  border:1px solid #e5e7eb;
  font-size:11px;
  color:#374151;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.camp-badge{
  display:inline-block;
  font-size:10px;
  padding:3px 8px;
  border-radius:999px;
  background:#fef3c7;
  color:#92400e;
}
.camp-title{
  font-size:13px;
  font-weight:600;
  color:#111827;
}
.camp-meta{
  font-size:11px;
  color:#6b7280;
}
.camp-foot{
  margin-top:4px;
  font-size:11px;
  color:#0f766e;
}

/* Toast */
.toast{
  position:fixed;
  top:16px;
  left:50%;
  transform:translateX(-50%) translateY(-10px);
  background:#111827;
  color:#fff;
  padding:8px 14px;
  border-radius:999px;
  font-size:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.3);
  opacity:0;
  pointer-events:none;
  transition:opacity .25s, transform .25s;
  z-index:999;
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* Responsive */
@media (max-width:768px){
  .shell{border-radius:18px;}
  .header{padding:14px 16px 16px;}
  .content{padding:14px 14px 18px;}
  .snapshot-wrap{
    grid-template-columns:1fr;
  }
}
</style>
</head>
<body>

<div id="toast" class="toast"></div>

<div class="shell">
  <!-- HEADER -->
  <div class="header">
    <div class="header-row">
      <div class="header-left">
        <div id="avatar"></div>
        <div>
          <div class="hl-title" id="greetTitle"></div>
          <div class="hl-sub" id="greetSub"></div>
        </div>
      </div>
      <div class="header-right">
        <div class="pb-tag">PB <span>(PaisaBada)</span> Dashboard</div>
        <div class="last-login" id="lastLoginText"></div>
      </div>
    </div>

    <!-- Stats row -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-label">Wallet Coins</div>
        <div class="stat-value" id="statCoins">0</div>
        <div class="stat-foot" id="statCoinsFoot">Use coins to save on your next policy.</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">XP Level</div>
        <div class="stat-value" id="statLevel">â€“</div>
        <div class="stat-foot" id="statXPFoot"></div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Policies in Portfolio</div>
        <div class="stat-value" id="statPolicies">0</div>
        <div class="stat-foot">Track all your covers in one place.</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Daily Streak</div>
        <div class="stat-value" id="statStreak">0 days</div>
        <div class="stat-foot" id="statStreakFoot"></div>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <!-- WHAT YOU CAN DO HERE -->
    <div class="section-title">
      <span>What you can do on PB</span>
      <small>Single place for money snapshot, tools & campaigns.</small>
    </div>
    <div class="do-card">
      <div class="do-title">From here you can:</div>
      <ul class="do-list">
        <li>View overall money snapshot</li>
        <li>Access all tools, offers and vault</li>
        <li>Check latest campaigns & rewards</li>
      </ul>
    </div>

    <!-- Snapshot & Next Action -->
    <div style="margin-top:8px;" class="section-title">
      <span>Your money snapshot</span>
      <small>Everything linked to your Paisabada account.</small>
    </div>

    <div class="snapshot-wrap">
      <div class="snapshot-card">
        <div class="snap-title">Snapshot of your Paisabada account</div>
        <div class="snap-sub">Updates as you buy, renew or learn.</div>

        <div class="snap-grid">
          <div class="snap-item">
            <div class="snap-item-label">Coins available</div>
            <div class="snap-item-value" id="snapCoins">0</div>
          </div>
          <div class="snap-item">
            <div class="snap-item-label">XP</div>
            <div class="snap-item-value" id="snapXP">0</div>
          </div>
          <div class="snap-item">
            <div class="snap-item-label">Level</div>
            <div class="snap-item-value" id="snapLevel">â€“</div>
          </div>
          <div class="snap-item">
            <div class="snap-item-label">Policies in portfolio</div>
            <div class="snap-item-value" id="snapPolicies">0</div>
          </div>
        </div>

        <div class="snap-highlight" id="snapHighlightText">
          Start by adding your first policy or exploring a health plan.
        </div>
      </div>

      <div class="next-action">
        <div class="na-label">Recommended next step</div>
        <div id="nextActionText"></div>
        <div class="na-foot" id="nextActionSub"></div>
        <div class="na-buttons">
          <button class="btn-chip" id="btnGoWallet">Go to Wallet</button>
          <button class="btn-chip secondary" id="btnGoPortfolio">View Portfolio</button>
        </div>
      </div>
    </div>

    <!-- Tools / Offers / Vault -->
    <div class="tools-section">
      <div class="section-title">
        <span>Tools, offers & vault</span>
        <small>Jump to any feature in one tap.</small>
      </div>
      <div class="tools-grid" id="toolsGrid">
        <!-- JS will inject -->
      </div>
    </div>

    <!-- Campaigns / Rewards -->
    <div class="campaigns">
      <div class="section-title">
        <span>Latest campaigns & rewards</span>
        <small>Use these to grow coins or save more.</small>
      </div>
      <div class="campaign-list" id="campaignList">
        <!-- JS will inject -->
      </div>
    </div>

  </div>
</div>

<script>
// ---- Auth check ----
if(localStorage.getItem("pbLoggedIn")!=="true"){
  window.location.href = "login.html";
}

let raw = localStorage.getItem("pbUser");
let user = null;
try{
  if(raw) user = JSON.parse(raw);
}catch(e){
  console.error("Invalid pbUser, resetting", e);
  localStorage.removeItem("pbUser");
}
if(!user){
  window.location.href = "login.html";
}

function saveUser(){
  localStorage.setItem("pbUser", JSON.stringify(user));
}

// Toast helper
function showToast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=> t.classList.remove("show"), 1200);
}

// ---- Avatar & Greeting ----
(function setupHeader(){
  const name = user.name || "User";
  const firstName = name.split(" ")[0];

  const initials = name.trim().split(" ")
    .filter(Boolean)
    .map(w=>w[0].toUpperCase())
    .slice(0,2)
    .join("");
  document.getElementById("avatar").textContent = initials || "P";

  const hour = new Date().getHours();
  let greetTime = "Welcome back";
  if(hour < 12) greetTime = "Good morning";
  else if(hour < 18) greetTime = "Good afternoon";
  else greetTime = "Good evening";

  document.getElementById("greetTitle").textContent =
    `${greetTime}, ${firstName}`;
  document.getElementById("greetSub").textContent =
    "View your money snapshot, tools and live offers in one place.";

  if(!user.lastLogin){
    user.lastLogin = new Date().toISOString();
    saveUser();
  }
  const lastLogin = new Date(user.lastLogin);
  document.getElementById("lastLoginText").textContent =
    `Last activity: ${lastLogin.toLocaleString()}`;
})();

// ---- XP & coins helpers ----
function getLevel(xp){
  if(xp >= 300) return "ðŸ¥‡ Gold Saver";
  if(xp >= 100) return "ðŸ¥ˆ Silver Saver";
  return "ðŸ¥‰ Bronze Saver";
}
function getNextXPGoal(xp){
  if(xp >= 300) return null;
  if(xp >= 100) return 300;
  return 100;
}

// ---- Fill stats & snapshot ----
function fillStatsAndSnapshot(){
  const coins = user.coins || 0;
  const xp = user.xp || 0;
  const policies = user.policiesCount || 0;
  const streak = user.streak || 0;
  const level = getLevel(xp);
  const nextGoal = getNextXPGoal(xp);

  document.getElementById("statCoins").textContent = coins;
  document.getElementById("statLevel").textContent = level;
  document.getElementById("statPolicies").textContent = policies;
  document.getElementById("statStreak").textContent = `${streak} days`;

  const coinsFoot = coins === 0
    ? "You haven't used your coins yet."
    : "Use coins on eligible policies to reduce premium instantly.";
  document.getElementById("statCoinsFoot").textContent = coinsFoot;

  let xpFoot = "";
  if(nextGoal){
    xpFoot = `${xp} XP â€¢ ${nextGoal - xp} XP to next level.`;
  }else{
    xpFoot = `${xp} XP â€¢ You unlocked the highest level.`;
  }
  document.getElementById("statXPFoot").textContent = xpFoot;

  const streakFoot = streak > 0
    ? "Keep checking regularly to maintain your awareness streak."
    : "Visit often to build a habit of checking your money.";
  document.getElementById("statStreakFoot").textContent = streakFoot;

  document.getElementById("snapCoins").textContent = coins;
  document.getElementById("snapXP").textContent = xp;
  document.getElementById("snapLevel").textContent = level;
  document.getElementById("snapPolicies").textContent = policies;

  const snapHighlightEl = document.getElementById("snapHighlightText");
  if(policies === 0 && coins === 0){
    snapHighlightEl.textContent =
      "Start by adding your first policy or exploring a health plan. This will unlock coins and XP.";
  }else if(coins > 0 && policies > 0){
    snapHighlightEl.textContent =
      "You already have coins and policies. Plan your next renewal with coins to maximise savings.";
  }else if(policies > 0 && coins === 0){
    snapHighlightEl.textContent =
      "You have policies in portfolio. Renew via Paisabada to unlock coins and extra benefits.";
  }else if(coins > 0 && policies === 0){
    snapHighlightEl.textContent =
      "You have coins ready. Use them to create your first protection stack â€” health + term.";
  }else{
    snapHighlightEl.textContent =
      "You are on track â€” review portfolio and cover once in a while to stay optimised.";
  }
}

// ---- Next action suggestion ----
function fillNextAction(){
  const coins = user.coins || 0;
  const policies = user.policiesCount || 0;

  let mainText = "";
  let subText = "";

  if(coins === 0 && policies === 0){
    mainText = "Start with a basic Health or Term plan for your family.";
    subText = "Your first policy via Paisabada will start your coins and XP journey.";
  }else if(coins > 0 && policies > 0){
    mainText = "Use your Paisabada Coins on your next renewal or new cover.";
    subText = "Focus on high impact covers like Health + Term to get maximum value from your coins.";
  }else if(coins > 0 && policies === 0){
    mainText = "You already have coins â€” convert them into long-term protection.";
    subText = "Pick a health or term plan and let coins reduce your premium.";
  }else{
    mainText = "Review existing covers and plug any gaps in your protection.";
    subText = "Compare your health, life and vehicle covers against your current lifestyle and income.";
  }

  document.getElementById("nextActionText").textContent = mainText;
  document.getElementById("nextActionSub").textContent = subText;
}

// ---- Tools / Offers / Vault config ----
const tools = [
  { id:"wallet", title:"Wallet", icon:"ðŸ‘›",
    sub:"See coins, XP and wallet rules.",
    tag:"Use coins smartly", url:"wallet.html" },
  { id:"portfolio", title:"My Portfolio", icon:"ðŸ“Š",
    sub:"View and manage all policies.",
    tag:"All covers in one place", url:"portfolio.html" },
  { id:"vault", title:"Policy Vault", icon:"ðŸ—„ï¸",
    sub:"Store and access policy documents.",
    tag:"Digital locker", url:"vault.html" },
  { id:"healthCheck", title:"Financial Health Check", icon:"ðŸ©º",
    sub:"Run a quick check on your money health.",
    tag:"3â€“5 minute check", url:"financial-health-check.html" },
  { id:"paisaPersonality", title:"Paisa Personality", icon:"ðŸ§ ",
    sub:"Understand your behaviour with money.",
    tag:"Fun quiz + insight", url:"paisa-personality.html" },
  { id:"elearn", title:"E-Learn", icon:"ðŸ“š",
    sub:"Short lessons on health, term, SIPs & more.",
    tag:"Learn before you buy", url:"elearn.html" },
  { id:"transactions", title:"Transactions / History", icon:"ðŸ“œ",
    sub:"Track payments and coin usage.",
    tag:"For proofs & tracking", url:"transactions.html" },
  { id:"refer", title:"Refer & Earn", icon:"ðŸŽ",
    sub:"Invite friends and earn coins.",
    tag:"Grow rewards faster", url:"refer.html" }
];

function openTool(item){
  showToast(item.title);
  const sep = item.url.includes("?") ? "&" : "?";
  const url = `${item.url}${sep}source=pb-dashboard`;
  window.location.href = url;
}

function renderTools(){
  const grid = document.getElementById("toolsGrid");
  grid.innerHTML = "";
  tools.forEach(t=>{
    const card = document.createElement("button");
    card.className = "tool-card";
    card.type = "button";
    card.setAttribute("aria-label", t.title + ". " + t.sub);
    card.innerHTML = `
      <div class="tool-icon">${t.icon}</div>
      <div class="tool-title">${t.title}</div>
      <div class="tool-sub">${t.sub}</div>
      <div class="tool-tag">${t.tag}</div>
    `;
    card.addEventListener("click", ()=>openTool(t));
    grid.appendChild(card);
  });
}

// ---- Campaigns / Rewards ----
const campaigns = [
  {
    badge:"Live",
    title:"Spin & Win â€“ extra coins on first policy",
    meta:"Complete your first policy purchase via Paisabada and spin to win bonus coins.",
    foot:"Tip: Combine this with your wallet coins for maximum benefit."
  },
  {
    badge:"Limited time",
    title:"Health + Term Combo Advantage",
    meta:"Buy a health plan and term plan within 30 days to unlock extra XP and exclusive offers.",
    foot:"Good for families building a long-term protection base."
  },
  {
    badge:"Recommended",
    title:"Refer & Earn booster",
    meta:"For every successful referral, both you and your friend earn bonus Paisabada Coins.",
    foot:"Share with family or colleagues who are due for renewal."
  }
];

function renderCampaigns(){
  const list = document.getElementById("campaignList");
  list.innerHTML = "";
  campaigns.forEach(c=>{
    const card = document.createElement("div");
    card.className = "camp-card";
    card.innerHTML = `
      <span class="camp-badge">${c.badge}</span>
      <div class="camp-title">${c.title}</div>
      <div class="camp-meta">${c.meta}</div>
      <div class="camp-foot">${c.foot}</div>
    `;
    list.appendChild(card);
  });
}

// ---- Buttons under Next Action ----
document.getElementById("btnGoWallet").addEventListener("click", ()=>{
  window.location.href = "wallet.html?from=pb-dashboard";
});
document.getElementById("btnGoPortfolio").addEventListener("click", ()=>{
  window.location.href = "portfolio.html?from=pb-dashboard";
});

// ---- Init ----
function init(){
  fillStatsAndSnapshot();
  fillNextAction();
  renderTools();
  renderCampaigns();
}
init();
</script>
</body>
</html>
